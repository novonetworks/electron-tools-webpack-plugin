{"version":3,"file":"index.es.js","sources":["../src/index.ts"],"sourcesContent":["import webpack, { Plugin, Compiler } from 'webpack'\nimport { build } from 'electron-builder'\nimport spawn from 'cross-spawn'\n\ninterface Options {\n    readonly main: string\n    readonly args?: string[]\n    readonly isDebug?: boolean\n}\n\nconst isDevelopment = process.env.NODE_ENV === 'development'\n\nexport class ElectronToolsWebpackPlugin implements Plugin {\n    private compiler: Compiler\n    private config: any\n    private eProcess: any\n\n    constructor(options: Options) {\n        this.log(`constructor: ${{ options }}`)\n        Object.assign(this.config, options)\n    }\n\n    public apply(compiler: Compiler): void {\n        this.log(`apply: ${{ compiler }}`)\n        this.compiler = compiler\n        if (isDevelopment) {\n            this.afterEmit()\n        } else {\n            this.done()\n        }\n    }\n    private afterEmit(): void {\n        this.log('afterEmit')\n        this.compiler.hooks.afterEmit.tap(\n            ElectronToolsWebpackPlugin.name,\n            this.startElectron,\n        )\n    }\n    private done(): void {\n        this.log('done')\n        this.compiler.hooks.afterEmit.tap(\n            ElectronToolsWebpackPlugin.name,\n            this.buildElectron,\n        )\n    }\n\n    private startElectron = (compilation: webpack.compilation.Compilation) => {\n        this.log('startElectron')\n        if (!this.config.main || this.eProcess) {\n            return\n        }\n        const existsAt = compilation.assets[this.config.main].existsAt\n        const args = [existsAt].concat(this.config.args)\n        this.eProcess = spawn('electron', args, {\n            env: process.env,\n            stdio: 'inherit',\n        })\n\n        this.eProcess.on('SIGINT', () => {\n            this.log('SIGINT')\n            process.exit(0)\n        })\n    }\n\n    private buildElectron = async () => {\n        this.log('buildElectron')\n        await build()\n    }\n\n    private log = (message?: any, ...optionalParams: any[]): void => {\n        this.config.isDebug && console.log(message, optionalParams)\n    }\n}\n\n// noinspection JSUnusedGlobalSymbols\nexport default ElectronToolsWebpackPlugin\n"],"names":[],"mappings":";;;AAUA,MAAM,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAA;AAE5D,MAAa,0BAA0B;IAKnC,YAAY,OAAgB;QA6BpB,kBAAa,GAAG,CAAC,WAA4C;YACjE,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAA;YACzB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACpC,OAAM;aACT;YACD,MAAM,QAAQ,GAAG,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAA;YAC9D,MAAM,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAA;YAChD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE;gBACpC,GAAG,EAAE,OAAO,CAAC,GAAG;gBAChB,KAAK,EAAE,SAAS;aACnB,CAAC,CAAA;YAEF,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE;gBACvB,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;gBAClB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;aAClB,CAAC,CAAA;SACL,CAAA;QAEO,kBAAa,GAAG;YACpB,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,CAAA;YACzB,MAAM,KAAK,EAAE,CAAA;SAChB,CAAA;QAEO,QAAG,GAAG,CAAC,OAAa,EAAE,GAAG,cAAqB;YAClD,IAAI,CAAC,MAAM,CAAC,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,cAAc,CAAC,CAAA;SAC9D,CAAA;QArDG,IAAI,CAAC,GAAG,CAAC,gBAAgB,EAAE,OAAO,EAAE,EAAE,CAAC,CAAA;QACvC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,CAAA;KACtC;IAEM,KAAK,CAAC,QAAkB;QAC3B,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,EAAE,EAAE,CAAC,CAAA;QAClC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAA;QACxB,IAAI,aAAa,EAAE;YACf,IAAI,CAAC,SAAS,EAAE,CAAA;SACnB;aAAM;YACH,IAAI,CAAC,IAAI,EAAE,CAAA;SACd;KACJ;IACO,SAAS;QACb,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;QACrB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,CAC7B,0BAA0B,CAAC,IAAI,EAC/B,IAAI,CAAC,aAAa,CACrB,CAAA;KACJ;IACO,IAAI;QACR,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;QAChB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,SAAS,CAAC,GAAG,CAC7B,0BAA0B,CAAC,IAAI,EAC/B,IAAI,CAAC,aAAa,CACrB,CAAA;KACJ;CA4BJ;;;;;"}